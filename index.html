<!--
  Grist Code Editor Pro Widget
  Copyright 2026 Said Hamadou (isaytoo)
  Licensed under the Apache License, Version 2.0
  https://github.com/isaytoo/grist-code-editor-pro-widget
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grist Code Editor Pro</title>
  <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
  <!-- Monaco Editor -->
  <link rel="stylesheet" data-name="vs/editor/editor.main" href="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/editor/editor.main.css">
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg-primary: #1e1e1e;
      --bg-secondary: #252526;
      --bg-tertiary: #2d2d30;
      --border-color: #3c3c3c;
      --text-primary: #cccccc;
      --text-secondary: #858585;
      --accent-color: #0e639c;
      --accent-hover: #1177bb;
      --success-color: #4ec9b0;
      --warning-color: #dcdcaa;
      --error-color: #f14c4c;
      --info-color: #569cd6;
    }

    html, body {
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      overflow: hidden;
    }

    /* ========== LAYOUT ========== */
    .app-container {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 16px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      flex-shrink: 0;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      font-size: 14px;
    }

    .logo-icon {
      font-size: 20px;
    }

    .header-tabs {
      display: flex;
      gap: 4px;
    }

    .header-tab {
      padding: 6px 12px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-size: 12px;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.15s;
    }

    .header-tab:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .header-tab.active {
      background: var(--accent-color);
      color: white;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn {
      padding: 6px 14px;
      border: none;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .btn-primary {
      background: var(--accent-color);
      color: white;
    }

    .btn-primary:hover {
      background: var(--accent-hover);
    }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background: #3c3c3c;
    }

    .btn-success {
      background: #2ea043;
      color: white;
    }

    .btn-success:hover {
      background: #3fb950;
    }

    /* ========== MAIN CONTENT ========== */
    .main-content {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    /* ========== SIDEBAR ========== */
    .sidebar {
      width: 280px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      overflow: hidden;
    }

    .sidebar-section {
      border-bottom: 1px solid var(--border-color);
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      color: var(--text-secondary);
      cursor: pointer;
      user-select: none;
    }

    .sidebar-header:hover {
      background: var(--bg-tertiary);
    }

    .sidebar-content {
      padding: 8px;
      max-height: 180px;
      overflow-y: auto;
    }

    .sidebar-content.collapsed {
      display: none;
    }

    .sidebar-section:last-child .sidebar-content {
      max-height: 250px;
    }

    /* Columns list */
    .column-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      font-size: 12px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.15s;
    }

    .column-item:hover {
      background: var(--bg-tertiary);
    }

    .column-type {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 3px;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
    }

    .column-type.text { background: #264f78; color: #9cdcfe; }
    .column-type.number { background: #4e3a1a; color: #dcdcaa; }
    .column-type.date { background: #3a1a4e; color: #c586c0; }
    .column-type.bool { background: #1a4e3a; color: #4ec9b0; }
    .column-type.ref { background: #4e1a1a; color: #f14c4c; }

    /* Snippets list */
    .snippet-item {
      padding: 8px 10px;
      font-size: 12px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.15s;
      border-left: 3px solid transparent;
    }

    .snippet-item:hover {
      background: var(--bg-tertiary);
      border-left-color: var(--accent-color);
    }

    .snippet-title {
      font-weight: 500;
      margin-bottom: 2px;
    }

    .snippet-desc {
      font-size: 11px;
      color: var(--text-secondary);
    }

    /* Templates list */
    .template-item {
      padding: 10px;
      font-size: 12px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.15s;
      background: var(--bg-tertiary);
      margin-bottom: 6px;
    }

    .template-item:hover {
      background: #3c3c3c;
    }

    .template-icon {
      font-size: 20px;
      margin-bottom: 4px;
    }

    .template-title {
      font-weight: 500;
    }

    /* ========== EDITOR AREA ========== */
    .editor-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .editor-tabs {
      display: flex;
      background: var(--bg-tertiary);
      border-bottom: 1px solid var(--border-color);
      flex-shrink: 0;
    }

    .editor-tab {
      padding: 8px 16px;
      font-size: 12px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.15s;
    }

    .editor-tab:hover {
      color: var(--text-primary);
      background: var(--bg-secondary);
    }

    .editor-tab.active {
      color: var(--text-primary);
      background: var(--bg-primary);
      border-bottom-color: var(--accent-color);
    }

    .editor-container {
      flex: 1;
      display: flex;
      overflow: hidden;
    }

    .editor-pane {
      flex: 1;
      display: none;
    }

    .editor-pane.active {
      display: flex;
      flex-direction: column;
    }

    #editor-js, #editor-html, #editor-css, #editor-python {
      flex: 1;
      height: 100%;
    }

    /* ========== PREVIEW AREA ========== */
    .preview-area {
      width: 50%;
      border-left: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      background: white;
    }

    .preview-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 12px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      flex-shrink: 0;
    }

    .preview-title {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-primary);
    }

    .preview-actions {
      display: flex;
      gap: 6px;
    }

    .preview-btn {
      padding: 4px 8px;
      font-size: 11px;
      background: var(--bg-tertiary);
      border: none;
      color: var(--text-primary);
      border-radius: 3px;
      cursor: pointer;
    }

    .preview-btn:hover {
      background: #3c3c3c;
    }

    .preview-frame {
      flex: 1;
      border: none;
      background: white;
    }

    /* ========== CONSOLE ========== */
    .console-area {
      height: 150px;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }

    .console-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 6px 12px;
      background: var(--bg-tertiary);
      border-bottom: 1px solid var(--border-color);
    }

    .console-title {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      color: var(--text-secondary);
    }

    .console-actions {
      display: flex;
      gap: 8px;
    }

    .console-btn {
      padding: 2px 8px;
      font-size: 10px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      border-radius: 3px;
    }

    .console-btn:hover {
      background: var(--bg-secondary);
      color: var(--text-primary);
    }

    .console-output {
      flex: 1;
      overflow-y: auto;
      padding: 8px 12px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 12px;
    }

    .console-line {
      padding: 2px 0;
      display: flex;
      align-items: flex-start;
      gap: 8px;
    }

    .console-line.log { color: var(--text-primary); }
    .console-line.info { color: var(--info-color); }
    .console-line.warn { color: var(--warning-color); }
    .console-line.error { color: var(--error-color); }

    .console-time {
      color: var(--text-secondary);
      font-size: 10px;
    }

    /* ========== STATUS BAR ========== */
    .status-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 4px 12px;
      background: var(--accent-color);
      font-size: 11px;
      color: white;
      flex-shrink: 0;
    }

    .status-left, .status-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .status-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    /* ========== RESIZER ========== */
    .resizer {
      width: 4px;
      background: var(--border-color);
      cursor: col-resize;
      transition: background 0.15s;
    }

    .resizer:hover {
      background: var(--accent-color);
    }

    /* ========== TOAST ========== */
    .toast-container {
      position: fixed;
      top: 16px;
      right: 16px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .toast {
      padding: 12px 16px;
      background: var(--bg-tertiary);
      border-radius: 6px;
      font-size: 13px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      gap: 10px;
      animation: slideIn 0.3s ease;
    }

    .toast.success { border-left: 3px solid var(--success-color); }
    .toast.error { border-left: 3px solid var(--error-color); }
    .toast.info { border-left: 3px solid var(--info-color); }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* ========== LOADING ========== */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--bg-tertiary);
      border-top-color: var(--accent-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ========== SCROLLBAR ========== */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-primary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--bg-tertiary);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #4c4c4c;
    }

    /* ========== GUIDE VIEW ========== */
    .guide-view {
      flex: 1;
      overflow-y: auto;
      background: var(--bg-primary);
      padding: 40px;
    }

    .guide-container {
      max-width: 900px;
      margin: 0 auto;
    }

    .guide-view h1 {
      font-size: 28px;
      margin-bottom: 30px;
      color: var(--text-primary);
      border-bottom: 2px solid var(--accent-color);
      padding-bottom: 15px;
    }

    .guide-section {
      margin-bottom: 35px;
    }

    .guide-section h2 {
      font-size: 20px;
      color: var(--text-primary);
      margin-bottom: 15px;
    }

    .guide-section p {
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .guide-note, .guide-warning {
      padding: 15px 20px;
      border-radius: 8px;
      margin: 15px 0;
    }

    .guide-note {
      background: rgba(14, 99, 156, 0.2);
      border-left: 4px solid var(--accent-color);
    }

    .guide-warning {
      background: rgba(241, 76, 76, 0.15);
      border-left: 4px solid var(--error-color);
    }

    .guide-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .guide-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 15px;
    }

    .guide-card h3 {
      font-size: 14px;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .guide-card p {
      font-size: 12px;
      margin: 0;
    }

    .guide-table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }

    .guide-table th, .guide-table td {
      padding: 12px 15px;
      text-align: left;
      border: 1px solid var(--border-color);
    }

    .guide-table th {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      font-weight: 600;
    }

    .guide-table td {
      color: var(--text-secondary);
    }

    .guide-steps {
      padding-left: 20px;
    }

    .guide-steps li {
      color: var(--text-secondary);
      margin-bottom: 12px;
      line-height: 1.5;
    }

    .guide-code {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      overflow: hidden;
    }

    .guide-code pre {
      padding: 20px;
      margin: 0;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 13px;
      color: var(--text-primary);
      overflow-x: auto;
      white-space: pre-wrap;
    }

    .guide-faq details {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      margin-bottom: 10px;
    }

    .guide-faq summary {
      padding: 15px;
      cursor: pointer;
      color: var(--text-primary);
      font-weight: 500;
    }

    .guide-faq summary:hover {
      background: var(--bg-tertiary);
    }

    .guide-faq details p {
      padding: 0 15px 15px;
      margin: 0;
    }

    .guide-footer {
      text-align: center;
      padding-top: 30px;
      border-top: 1px solid var(--border-color);
      margin-top: 40px;
    }

    .guide-footer a {
      color: var(--accent-color);
      text-decoration: none;
    }

    code {
      background: var(--bg-tertiary);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 12px;
    }

    /* ========== DROPDOWN ========== */
    .dropdown {
      position: relative;
      display: inline-block;
    }

    .dropdown-menu {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 100;
      min-width: 180px;
      margin-top: 4px;
    }

    .dropdown-menu.show {
      display: block;
    }

    .dropdown-menu button {
      display: block;
      width: 100%;
      padding: 10px 14px;
      background: none;
      border: none;
      color: var(--text-primary);
      font-size: 13px;
      text-align: left;
      cursor: pointer;
      transition: background 0.15s;
    }

    .dropdown-menu button:hover {
      background: var(--bg-tertiary);
    }

    .dropdown-menu button:first-child {
      border-radius: 6px 6px 0 0;
    }

    .dropdown-menu button:last-child {
      border-radius: 0 0 6px 6px;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- HEADER -->
    <div class="header">
      <div class="header-left">
        <div class="logo">
          <span class="logo-icon">‚ö°</span>
          <span>Code Editor Pro</span>
        </div>
        <div class="header-tabs">
          <button class="header-tab active" data-view="editor" onclick="switchView('editor')">√âditeur</button>
          <button class="header-tab" data-view="preview-only" onclick="switchView('preview-only')">Aper√ßu seul</button>
          <button class="header-tab" data-view="guide" onclick="switchView('guide')">üìñ Guide</button>
        </div>
      </div>
      <div class="header-actions">
        <button class="btn btn-secondary" onclick="resetCode()">üîÑ Reset</button>
        <button class="btn btn-primary" onclick="runPreview()">‚ñ∂Ô∏è Ex√©cuter</button>
        <button class="btn btn-success" onclick="installWidget()">üíæ Installer</button>
        <button class="btn btn-secondary" onclick="exportAsZip()">ÔøΩ Exporter ZIP</button>
      </div>
    </div>

    <!-- GUIDE VIEW -->
    <div id="guide-view" class="guide-view" style="display:none;">
      <div class="guide-container">
        <h1>üìñ Guide d'utilisation - Code Editor Pro</h1>
        
        <div class="guide-section">
          <h2>üéØ √Ä quoi sert ce widget ?</h2>
          <p>Code Editor Pro vous permet de <strong>cr√©er des widgets Grist personnalis√©s</strong> directement dans votre document, sans avoir besoin d'h√©berger de fichiers externes.</p>
          <div class="guide-note">
            <strong>üí° Id√©al pour :</strong> Affichages personnalis√©s, dashboards simples, formulaires sp√©cifiques, visualisations de donn√©es.
          </div>
        </div>

        <div class="guide-section">
          <h2>üñ•Ô∏è Interface</h2>
          <div class="guide-grid">
            <div class="guide-card">
              <h3>üìä Colonnes disponibles</h3>
              <p>Liste des colonnes de la table connect√©e. Cliquez pour ins√©rer <code>record.NomColonne</code> dans votre code.</p>
            </div>
            <div class="guide-card">
              <h3>üìù Snippets</h3>
              <p>Exemples de code pr√™ts √† l'emploi. Cliquez pour remplacer votre code actuel.</p>
            </div>
            <div class="guide-card">
              <h3>üé® Templates</h3>
              <p>Mod√®les de widgets complets (Dashboard KPI, Liste stylis√©e, etc.)</p>
            </div>
            <div class="guide-card">
              <h3>üìö API Grist</h3>
              <p>R√©f√©rence des fonctions Grist disponibles avec autocompl√©tion.</p>
            </div>
          </div>
        </div>

        <div class="guide-section">
          <h2>üìú Onglets de code</h2>
          <table class="guide-table">
            <tr><th>Onglet</th><th>Description</th><th>Usage</th></tr>
            <tr><td><strong>JavaScript</strong></td><td>Logique du widget</td><td>Interactions avec Grist API, manipulation des donn√©es</td></tr>
            <tr><td><strong>HTML</strong></td><td>Structure de la page</td><td>√âl√©ments visuels, conteneurs</td></tr>
            <tr><td><strong>CSS</strong></td><td>Styles visuels</td><td>Couleurs, tailles, mise en page</td></tr>
            <tr><td><strong>Python</strong></td><td>Formules Grist</td><td>Aide-m√©moire pour les formules de colonnes (√† copier dans Grist)</td></tr>
          </table>
        </div>

        <div class="guide-section">
          <h2>üîò Boutons d'action</h2>
          <table class="guide-table">
            <tr><th>Bouton</th><th>Action</th></tr>
            <tr><td><strong>üîÑ Reset</strong></td><td>R√©initialise le code aux valeurs par d√©faut</td></tr>
            <tr><td><strong>‚ñ∂Ô∏è Ex√©cuter</strong></td><td>Lance l'aper√ßu du widget (sans sauvegarder)</td></tr>
            <tr><td><strong>üíæ Installer</strong></td><td>Sauvegarde le code dans le document Grist</td></tr>
          </table>
          <div class="guide-warning">
            <strong>‚ö†Ô∏è Important :</strong> Sans cliquer sur "Installer", votre code sera perdu au rechargement de la page !
          </div>
        </div>

        <div class="guide-section">
          <h2>üöÄ D√©marrage rapide</h2>
          <ol class="guide-steps">
            <li><strong>Connectez une table</strong> - S√©lectionnez une table dans les param√®tres du widget Grist</li>
            <li><strong>Choisissez un template</strong> - Cliquez sur un template dans la sidebar gauche</li>
            <li><strong>Personnalisez</strong> - Modifiez le code JavaScript/HTML/CSS selon vos besoins</li>
            <li><strong>Testez</strong> - Cliquez sur "Ex√©cuter" pour voir le r√©sultat</li>
            <li><strong>Installez</strong> - Cliquez sur "Installer" pour sauvegarder</li>
          </ol>
        </div>

        <div class="guide-section">
          <h2>üì¶ Exporter votre widget</h2>
          <p>Une fois votre widget termin√©, vous pouvez l'exporter pour l'utiliser dans d'autres documents Grist.</p>
          
          <h3 style="margin-top: 20px; font-size: 16px;">üìÅ Exporter en fichier ZIP</h3>
          <p>T√©l√©charge un fichier ZIP contenant tous les fichiers de votre widget, pr√™ts √† √™tre h√©berg√©s.</p>
          <ol class="guide-steps">
            <li>Cliquez sur <strong>"üì¶ Exporter ZIP"</strong></li>
            <li>Un fichier <code>mon-widget-grist.zip</code> est t√©l√©charg√©</li>
            <li>D√©compressez le fichier, vous obtenez :
              <ul style="margin-top: 8px; margin-left: 20px;">
                <li><code>index.html</code> - Page principale</li>
                <li><code>widget.js</code> - Code JavaScript</li>
                <li><code>style.css</code> - Styles CSS</li>
                <li><code>formulas.py</code> - Aide-m√©moire Python</li>
                <li><code>README.md</code> - Instructions</li>
              </ul>
            </li>
            <li>H√©bergez ces fichiers sur <strong>GitHub Pages</strong>, <strong>Vercel</strong>, ou <strong>Netlify</strong></li>
            <li>Dans Grist, ajoutez un widget personnalis√© et collez l'URL de votre h√©bergement</li>
          </ol>
          <div class="guide-note">
            <strong>üí° Conseil :</strong> GitHub Pages est gratuit et facile √† configurer. Cr√©ez un repo, activez Pages, et votre widget est en ligne !
          </div>
        </div>

        <div class="guide-section">
          <h2>üìö Fonctions Grist essentielles</h2>
          <div class="guide-code">
            <pre>// Initialiser le widget
grist.ready({ requiredAccess: 'read table' });

// √âcouter l'enregistrement s√©lectionn√©
grist.onRecord(function(record) {
  console.log('Enregistrement:', record);
});

// √âcouter tous les enregistrements
grist.onRecords(function(records) {
  console.log('Tous les enregistrements:', records);
});

// Cr√©er un enregistrement
await grist.selectedTable.create({ fields: { Nom: 'Test' } });

// Modifier un enregistrement
await grist.selectedTable.update({ id: 1, fields: { Nom: 'Nouveau' } });

// Supprimer un enregistrement
await grist.selectedTable.destroy(1);</pre>
          </div>
        </div>

        <div class="guide-section">
          <h2>üêç Formules Python (pour colonnes Grist)</h2>
          <div class="guide-code">
            <pre># R√©f√©rencer une colonne
$Nom + " " + $Prenom

# Condition
"Urgent" if $Priorite == "haute" else "Normal"

# Recherche (VLOOKUP)
Clients.lookupOne(Email=$Email).Nom

# Somme conditionnelle (SUMIF)
sum(Ventes.lookupRecords(Statut="Valid√©").Montant)

# Comptage
len(Taches.lookupRecords(Statut="Termin√©"))

# Date du jour
NOW()</pre>
          </div>
        </div>

        <div class="guide-section">
          <h2>‚ùì FAQ</h2>
          <div class="guide-faq">
            <details>
              <summary>Mon code ne s'affiche pas dans l'aper√ßu ?</summary>
              <p>V√©rifiez la console (bouton "Console") pour voir les erreurs JavaScript.</p>
            </details>
            <details>
              <summary>Comment acc√©der aux donn√©es de la table ?</summary>
              <p>Utilisez <code>grist.onRecord()</code> pour l'enregistrement s√©lectionn√© ou <code>grist.onRecords()</code> pour tous les enregistrements.</p>
            </details>
            <details>
              <summary>Le widget ne se connecte pas √† la table ?</summary>
              <p>Assurez-vous d'avoir s√©lectionn√© une table dans les param√®tres du widget (panneau de droite dans Grist).</p>
            </details>
            <details>
              <summary>Comment sauvegarder mon travail ?</summary>
              <p>Cliquez sur "Installer" pour sauvegarder le code dans le document Grist.</p>
            </details>
          </div>
        </div>

      </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content">
      <!-- SIDEBAR -->
      <div class="sidebar">
        <!-- Columns Section -->
        <div class="sidebar-section">
          <div class="sidebar-header" onclick="toggleSection(this)">
            <span>üìä Colonnes disponibles</span>
            <span class="toggle-icon">‚ñ∂</span>
          </div>
          <div class="sidebar-content collapsed" id="columns-list">
            <div style="color: var(--text-secondary); font-size: 11px; padding: 8px;">
              Connectez une table pour voir les colonnes...
            </div>
          </div>
        </div>

        <!-- Snippets Section -->
        <div class="sidebar-section">
          <div class="sidebar-header" onclick="toggleSection(this)">
            <span>üìù Snippets</span>
            <span class="toggle-icon">‚ñ∂</span>
          </div>
          <div class="sidebar-content collapsed" id="snippets-list">
            <!-- Populated by JS -->
          </div>
        </div>

        <!-- Templates Section -->
        <div class="sidebar-section">
          <div class="sidebar-header" onclick="toggleSection(this)">
            <span>üé® Templates</span>
            <span class="toggle-icon">‚ñ∂</span>
          </div>
          <div class="sidebar-content collapsed" id="templates-list">
            <!-- Populated by JS -->
          </div>
        </div>

        <!-- API Reference Section -->
        <div class="sidebar-section" style="flex:1; display:flex; flex-direction:column; min-height:0;">
          <div class="sidebar-header" onclick="toggleSection(this)">
            <span>üìö API Grist</span>
            <span class="toggle-icon">‚ñ∂</span>
          </div>
          <div class="sidebar-content collapsed" id="api-list" style="flex:1; max-height:none; overflow-y:auto;">
            <!-- Populated by JS -->
          </div>
        </div>
      </div>

      <!-- EDITOR AREA -->
      <div class="editor-area">
        <div class="editor-tabs">
          <button class="editor-tab active" data-tab="js" onclick="switchEditorTab('js')">üìú JavaScript</button>
          <button class="editor-tab" data-tab="html" onclick="switchEditorTab('html')">üåê HTML</button>
          <button class="editor-tab" data-tab="css" onclick="switchEditorTab('css')">üé® CSS</button>
          <button class="editor-tab" data-tab="python" onclick="switchEditorTab('python')">üêç Python</button>
        </div>
        <div class="editor-container">
          <div class="editor-pane active" id="pane-js">
            <div id="editor-js"></div>
          </div>
          <div class="editor-pane" id="pane-html">
            <div id="editor-html"></div>
          </div>
          <div class="editor-pane" id="pane-css">
            <div id="editor-css"></div>
          </div>
          <div class="editor-pane" id="pane-python">
            <div id="editor-python"></div>
          </div>
        </div>
      </div>

      <!-- RESIZER -->
      <div class="resizer" id="resizer"></div>

      <!-- PREVIEW AREA -->
      <div class="preview-area" id="preview-area">
        <div class="preview-header">
          <span class="preview-title">üì± Aper√ßu</span>
          <div class="preview-actions">
            <button class="preview-btn" onclick="runPreview()">üîÑ Rafra√Æchir</button>
            <button class="preview-btn" onclick="toggleConsole()">üìã Console</button>
          </div>
        </div>
        <iframe id="preview-frame" class="preview-frame"></iframe>
      </div>
    </div>

    <!-- CONSOLE -->
    <div class="console-area" id="console-area">
      <div class="console-header">
        <span class="console-title">Console</span>
        <div class="console-actions">
          <button class="console-btn" onclick="clearConsole()">Effacer</button>
        </div>
      </div>
      <div class="console-output" id="console-output"></div>
    </div>

    <!-- STATUS BAR -->
    <div class="status-bar">
      <div class="status-left">
        <span class="status-item">üìÑ <span id="status-table">Aucune table</span></span>
        <span class="status-item">üìä <span id="status-records">0 enregistrements</span></span>
      </div>
      <div class="status-right">
        <span class="status-item" id="status-saved">Non sauvegard√©</span>
      </div>
    </div>
  </div>

  <!-- TOAST CONTAINER -->
  <div class="toast-container" id="toast-container"></div>

  <!-- FOOTER -->
  <footer style="position: fixed; bottom: 0; left: 0; right: 0; background: #1e1e1e; border-top: 1px solid #3c3c3c; padding: 4px 12px; font-size: 0.7em; color: #858585; display: flex; justify-content: space-between; z-index: 1000;">
    <span>¬© 2026 Said Hamadou (isaytoo)</span>
    <a href="https://gristup.fr" target="_blank" style="color: #569cd6; text-decoration: none;">gristup.fr</a>
  </footer>

  <!-- Monaco Editor Loader -->
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>
  <script src="widget.js"></script>
</body>
</html>
